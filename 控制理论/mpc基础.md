## mpc基础

### 介绍

[原理](https://zhuanlan.zhihu.com/p/99409532)

[简单理解mpc](https://wjrsbu.smartapps.cn/pages/answer/index?id=3300261966&isshared=1&bdswankey=vivobrowser%3A%2F%2Fswan%2Fofx3nbddn6gwf3vb0wh7edbmbxrttcfe%2Fzhihu%2Fanswer%3Fid%3D3300261966%26from%3D1599_n_6%2540ghbl1m8zk_1_n%26searchparams%3D%257b%2522failurl%2522%253a%2522https%253a%255c%252f%255c%252fwww.zhihu.com%255c%252fquestion%255c%252f630545682%255c%252fanswer%255c%252f3300261966%2522%257d%26usetpl%3D1&_swebfr=1)

模型预测控制（MPC）是一种控制方法，它利用一个已知的模型，根据系统**当前的状态和期望的输出**，来**预测和优化系统未来的控制量**。

MPC的基本思想是：

- 在每个控制周期，根据系统模型和当前状态，预测未来一段时间内（预测时域）的系统输出。
- 将预测的输出与期望的输出进行比较，构建一个损失函数，表示系统的性能。

```c
损失函数可以按照需要来定义（比如能源消耗最小、时间最短、稳定性最好等），通过解决这个优化问题得到该变量最优的输入路径或轨迹。通常都定义为（x-xr)的范数的平方
```

- 通过求解一个优化问题(==轨迹最优问题==)，找到最优的控制量序列，使得损失函数最小。
- 将控制量序列中的第一个元素作为当前控制周期的控制量，应用到系统上。
- 在下一个控制周期，重复上述步骤。

MPC的优点是：

- 可以处理多输入多输出、非线性、受约束的系统。
- 可以考虑系统的前瞻性，避免贪婪或短视的控制策略。(预测步长)
- 可以灵活地定义损失函数和约束条件，满足不同的控制目标和需求。

MPC的缺点是：

- 需要有准确且可行的系统模型。
- 需要在每个控制周期内实时求解优化问题，可能存在计算复杂度和实时性的问题。
- 需要选择合适的预测时域和控制时域，平衡计算开销和控制性能。

### 专有名词

- **状态和输入(states and inputs)**
- **模型(model)**

```c
系统模型既可以是非线性的，也可以是线性的
```

- **代价函数(cost function)**

```c
也称为损失函数
```

- **约束(constraints)**

```
系统状态量或者输入量的约束条件，可以是线性的，也可以是非线性的
```

- **预测时长(prediction horizon)**

```c
也可以称作预测步长，表示求解从当前时刻到预测步长内这段时间内的优化问题。这个值太大的话会浪费大量的算力，如果太小的话会影响控制效果(汽车刹车刹不住)
```

- **控制时长(control horizon)**

```c
也可以称作控制步长，mpc控制步长是指控制器执行优化计算的时间间隔。在实际应用中，MPC的控制步长通常由系统的采样时间确定。这意味着mpc控制器在每个采样时间间隔内执行一次优化计算。通常控制歩长会比采样时间快2-3歩
```

- **求解最优控制问题(solve optimal control problem)**

```c
最优控制问题就是在求"轨迹最优"，"轨迹最优"通常指的是在给定条件下，在一定时间内实现特定目标的最佳路径或轨迹。在机器人、飞行器、汽车等领域中，轨迹最优往往指的是在考虑各种限制条件（比如避障、能量消耗、时间限制等）的情况下，找到一条使得某种性能指标（比如能源消耗最小、时间最短、稳定性最好等）最优的路径或轨迹。通过优化算法和控制策略，可以找到满足这些条件的最佳轨迹。
```

- **反馈 / 滚动优化(feedback / receding horizon)**

```c
滚动优化是MPC引入反馈的方式，这也是MPC又被称为Receding Horizon Control(RHC)的原因。如果没有反馈，只做开环控制，那么系统才跑到一些奇怪的地方的时候，无法及时做出反应，会很危险。系统在有足够高频的反馈的情况下，可以及时调整。反之，如果抛弃了feedback，或者feedback的频率很低，就很可能造成危险。
```

